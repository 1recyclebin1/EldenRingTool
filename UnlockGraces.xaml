<Window x:Class="EldenRingTool.UnlockGraces"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:EldenRingTool"
        Title="Activate Graces" Height="500" Width="700" ResizeMode="NoResize">
    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="75"/>
        </Grid.RowDefinitions>

        <!-- Search Bar -->
        <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
            <Label>Search:</Label>
            <TextBox x:Name="FilterBox" Width="225" Margin="5,0,0,0" TextChanged="FilterBox_TextChanged"/>
            <Button Content="X" Width="20" Height="20" Margin="5,0,0,0" Click="ClearFilter_Click"/>
        </StackPanel>

        <!-- Available Graces Tree -->
        <TreeView x:Name="AvailableGracesTree"
                  Grid.Column="0" Grid.Row="1"
                  ItemsSource="{Binding AvailableGracesGrouped}"
                  SelectedItemChanged="AvailableGracesTree_SelectedItemChanged">
            <TreeView.Resources>
                <!-- AreaGroup template -->
                <HierarchicalDataTemplate DataType="{x:Type local:AreaGroup}" ItemsSource="{Binding SubAreas}">
                    <TextBlock Text="{Binding Area}" FontWeight="Bold"/>
                </HierarchicalDataTemplate>

                <!-- SubAreaGroup template -->
                <HierarchicalDataTemplate DataType="{x:Type local:SubAreaGroup}" ItemsSource="{Binding Graces}">
                    <TextBlock Text="{Binding SubArea}" FontStyle="Italic"/>
                </HierarchicalDataTemplate>

                <!-- Grace template (leaf) -->
                <DataTemplate DataType="{x:Type local:Grace}">
                    <TextBlock Text="{Binding Name}"/>
                </DataTemplate>
            </TreeView.Resources>

            <TreeView.ItemContainerStyle>
                <Style TargetType="TreeViewItem">
                    <EventSetter Event="MouseDoubleClick" Handler="AvailableGraces_DoubleClick"/>
                </Style>
            </TreeView.ItemContainerStyle>
        </TreeView>

        <!-- Shuttle Buttons -->
        <StackPanel Grid.Column="1" Grid.Row="1" VerticalAlignment="Center" Margin="10,0">
            <Button Content="&gt;" Click="AddGrace_Click" Width="40" Margin="0 5"/>
            <Button Content="&lt;" Click="RemoveGrace_Click" Width="40" Margin="0 5"/>
        </StackPanel>

        <!-- Selected Graces List -->
        <ListBox x:Name="SelectedGracesList"
                 Grid.Column="2" Grid.Row="1"
                 ItemsSource="{Binding SelectedGraces}" SelectionMode="Extended">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <TextBlock>
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0} - {1} - {2}">
                                <Binding Path="Area"/>
                                <Binding Path="SubArea"/>
                                <Binding Path="Name"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <!-- Activate Button -->
        <StackPanel Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
            <Button x:Name="ActivateSelectedButton" Content="Activate" Click="ActivateSelected_Click" Width="100" IsEnabled="False"/>
        </StackPanel>

    </Grid>
</Window>
